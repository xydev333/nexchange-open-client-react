import React from 'react';
import jsonp from 'jsonp';
<<<<<<< HEAD
import { I18n } from 'react-i18next';
=======
import styles from './SubscriptionForm.scss';
>>>>>>> Header completely done.

const getAjaxUrl = url => url.replace('/post?', '/post-json?');
const subscribeUrl = 'https://nexchange.us16.list-manage.com/subscribe/post?u=918b60ce5b05d82384c293db0&amp;id=b2af978303';

class SubscriptionForm extends React.Component {
  constructor(props, ...args) {
    super(props, ...args);
    this.state = {
      status: null,
      msg: null,
    };
  }

  onSubmit = e => {
    e.preventDefault();
    if (!this.input.value || this.input.value.length < 5 || this.input.value.indexOf('@') === -1) {
      this.setState({
        status: 'error',
      });
      return;
    }

    const url = getAjaxUrl(subscribeUrl) + `&EMAIL=${encodeURIComponent(this.input.value)}`;
    this.setState(
      {
        status: 'sending',
        msg: null,
      },
      () =>
        jsonp(
          url,
          {
            param: 'c',
          },
          (err, data) => {
            if (err) {
              this.setState({
                status: 'error',
                msg: err,
              });
            } else if (data.result !== 'success') {
              this.setState({
                status: 'error',
                msg: data.msg,
              });
            } else {
              this.setState({
                status: 'success',
                msg: data.msg,
              });
            }
          }
        )
    );
  };

  render() {
    const { action } = this.props;
    const { status } = this.state;

    return (
<<<<<<< HEAD
	<I18n ns="translations">
		{
		(t) => (
      <div id="subscription-form">
        <div className="container text-center">
          <h2>{t('subscription.1')}</h2>
=======
      <div className={styles.container}>
        <div className="container text-center">
          <h2>Do you have any questions?</h2>
          <h3>Don't hesitate and get in touch with us</h3>
>>>>>>> Header completely done.

          <form action={action} method="post" noValidate>
            <div id="subscription-form-inner">
              <div className="col-xs-12 col-sm-9">
                <div className="form-group is-empty has-success">
                  <input
                    ref={node => (this.input = node)}
                    type="email"
                    name="EMAIL"
                    placeholder={t('subscription.2')}
                    className="form-control"
                    required
                  />
                  <span className="material-input" />
                </div>
              </div>

              <div className="col-xs-12 col-sm-3">
                <button
                  disabled={this.state.status === 'sending' || this.state.status === 'success'}
                  type="submit"
                  className="btn btn-primary"
                  onClick={this.onSubmit}
                >
                  Subscribe
                </button>
              </div>

              <div className="col-xs-12 message">
                {status === 'success' && (
                  <p className="success">
                    {t('subscription.4')}
                  </p>
                )}
                {status === 'error' && <p className="failure">{t('subscription.5')}</p>}
              </div>
            </div>
          </form>
        </div>
      </div>
	 )}
	</I18n>
    );
  }
}

export default SubscriptionForm;
